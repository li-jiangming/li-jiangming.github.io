<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>
        
                Qooqle|关于c语言文件读写
        
    </title>
    <link rel="stylesheet" href="/static/css/global.css">
    
    <link rel="stylesheet" href="/static/css/post.css">
    <!--    <link rel="stylesheet" href="/static/css/solarized.dark.css"> -->
    
</head>
<body>
    <header>
        <h1><a class="logo" href="/">Qooqle</a></h1>
        <ul class="nav">
            <li><h2><a href="/categories.html">Categories</a></h2></li>
            <li><h2><a href="/tags.html">Tags</a></h2></li>
            <li><h2><a href="/about.html">About</a></h2></li>
        </ul>
    </header>

    <div class="content">
            <h3 class="post-title">关于c语言文件读写</h3>
    <div class="post-date">Oct 11, 2015</div>
    <div class="post-content">
        <p>这几天在做多线程文件下载工具，遇到关于文件读写一些以前没有注意的问题。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fopen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">);</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">fopen</code>函数需要两个参数，第一个参数<code class="highlighter-rouge">path</code>是要打开文件的路径，第二个参数<code class="highlighter-rouge">mode</code>是要打开文件的方式。</p>

<p>打开文件的方式有以下几种：</p>

<p><code class="highlighter-rouge">r</code>以只读模式打开文件，文件指针置于文件内容起始位置，文件不存在返回NULL。</p>

<p><code class="highlighter-rouge">w</code>以只写模式打开文件，文件指针置于文件内容起始位置，文件存在会清空当前文件内容，文件不存在会新建文件。</p>

<p><code class="highlighter-rouge">a</code>以文件末尾追加方式打开（只写），文件指针置于文件内容末尾位置，使用此方式打开文件，不能设置文件指针偏移量，即<code class="highlighter-rouge">fseek</code>函数无效，文件不存在会新建文件。</p>

<p><code class="highlighter-rouge">+</code>放在<code class="highlighter-rouge">r</code>或<code class="highlighter-rouge">w</code>后表示既可读又可写，但是<code class="highlighter-rouge">r+</code>不会创建文件，<code class="highlighter-rouge">w+</code>依然会清空当前存在的文件。另外，如果使用<code class="highlighter-rouge">a+</code>，则意味着从文件起始位置读内容，从文件尾部追加内容。文件不存在会新建文件。</p>

<p><code class="highlighter-rouge">b</code>放在读写参数的最后面表示以二进制方式操作文件,<code class="highlighter-rouge">unix</code>下有无此参数效果一样。</p>

<p>在我的多线程下载工具中，多个线程打开本地同一个文件，每个线程往文件中写入内容的位置都会有一个偏移量。为了设置偏移量和数据不清空的情况下向文件中写入数据，在下载任务开始前，先检测当前指定路径的文件是否存在，为确保不损坏已有文件数据，在确定当前目录下指定文件不存在的情况下，我使用<code class="highlighter-rouge">w</code>方式新建文件。在下载文件多线程任务中使用<code class="highlighter-rouge">r+b</code>方式打开文件，这样就是得到预期的功能。</p>

    </div>

    </div>
    <footer>
        Power by Jekyll, stored in Github.
    </footer>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="/static/js/footer_bottom.js"></script>
</body>
</html>
