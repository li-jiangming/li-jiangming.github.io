---
layout: post
title: 使用GDB调试程序
category: Study
tags: gdb
---

参考了[gdb调试利器][gdb_link]，并对常用命令进行了测试，然后自己再总结一下`GDB`的使用。

## 使用GDB调试的前提

在编译程序时需加`-g`选项。

## GDB调试准备

### 带参程序

1. `set args 参数列表`：给需要参数的程序添加参数，例：`set args 10`。
2. `show args`：查看参数列表内容。

### 运行环境

1. `set <path>`：设置程序运行环境，例：`set /home/user`。
2. `show paths`：查看当前的运行环境。

### 环境变量

1. `set environment key=value`：设置环境变量。
2. `show environment key`：查看环境变量名为`key`的值。

## GDB调试步进

1. `run(r)`：执行此命令即程序以调试模式开始运行，直到遇到断点停止或程序结束。
2. `continue(c)`：从当前断点位置继续执行，直到下一个断点停止或程序结束。
3. `next(n)`：单步执行，遇到函数时不进入函数体，相当于我们经常在IDE中调试使用的`F10`。
4. `step(s)`：单步执行，遇到函数时进入函数体，相当于我们经常在IDE中调试使用的`F11`。

## GDB断点设置

1. `break(b)`：可接行号或函数名，可带上路径和文件名，例：`break a.c:10`。
2. `delete n`：断点号`n`可使用`info b`查看，用来删除某个断点。
3. `disable n`：屏蔽断点号为`n`的断点。
4. `enable n`：激活断点号为`n`的断点。
5. `clear n`：清除第`n`行的断点。
6. `info b(breakpoints)`：查看当前程序设置的所有断点的信息。
7. `delete breakpoints`：删除当前程序的所有断点。

## 打印表达式

1. `print(p) 表达式`：表达式可以是变量或函数，打印表达式的值，打印前会计算表达式。
2. `display 表达式`：设置此变量后，每次单步执行都将打印表达式的值。
3. `whatis 表达式`：查看表达式的类型信息。
4. `info function`：查看函数地址信息。
5. `info locals`：查看当前堆栈页所有变量的信息。

## 查看源码

* `list(l)`：查看源码。有下列几种情况：
    1. 程序未运行，第一次执行不带参数，从第一行开始；
    2. 程序运行过程中，则显示当前运行位置的内容。默认每次输出十行；
    3. 带参数时，可跟行号或函数名；
    4. 不带参数时，则接着输出上一次输出之后的内容。

## 查看栈

* `backtrace(bt)`：查看栈信息。带参和不带参说明：
    1. 不带参，查看当前函数的栈信息。
    2. 带参，只查看当前函数指定行数的栈信息。

## 分割窗口

* `layout`：分割窗口。后可跟下列几个参数之一：
    1. `src`：源码窗口。
    2. `asm`：反汇编窗口。
    3. `split`：源码和反汇编窗口。
    4. `regs`：反汇编和CPU寄存器窗口。

## 其他

* `quit(q)`：退出`GDB`。
* `info terminal`：查看终端信息。
* 执行`shell`命令`cd`切换目录，命令`pwd`查看当前目录。

[gdb_link]: http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/gdb.html
