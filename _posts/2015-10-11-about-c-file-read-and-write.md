---
layout: post
title: 关于c语言文件读写
category: Study
tags: C File
---

这几天在做多线程文件下载工具，遇到关于文件读写一些以前没有注意的问题。

```c
#include <stdio.h>

FILE *
fopen(const char *path, const char *mode);
```

`fopen`函数需要两个参数，第一个参数`path`是要打开文件的路径，第二个参数`mode`是要打开文件的方式。

打开文件的方式有以下几种：

`r`以只读模式打开文件，文件指针置于文件内容起始位置，文件不存在返回NULL。

`w`以只写模式打开文件，文件指针置于文件内容起始位置，文件存在会清空当前文件内容，文件不存在会新建文件。

`a`以文件末尾追加方式打开（只写），文件指针置于文件内容末尾位置，使用此方式打开文件，不能设置文件指针偏移量，即`fseek`函数无效，文件不存在会新建文件。

`+`放在`r`或`w`后表示既可读又可写，但是`r+`不会创建文件，`w+`依然会清空当前存在的文件。另外，如果使用`a+`，则意味着从文件起始位置读内容，从文件尾部追加内容。文件不存在会新建文件。

`b`放在读写参数的最后面表示以二进制方式操作文件,`unix`下有无此参数效果一样。

在我的多线程下载工具中，多个线程打开本地同一个文件，每个线程往文件中写入内容的位置都会有一个偏移量。为了设置偏移量和数据不清空的情况下向文件中写入数据，在下载任务开始前，先检测当前指定路径的文件是否存在，为确保不损坏已有文件数据，在确定当前目录下指定文件不存在的情况下，我使用`w`方式新建文件。在下载文件多线程任务中使用`r+b`方式打开文件，这样就是得到预期的功能。
